{% include "_head.html" %}
{% include "_language_nav.html" %}
{% include "_header.html" %}

<main id="admin" mix-title="{{ languages.admin }}">
    <div id="toast-container" class="toast-container">
        {% if message %}
        <div class="toast toast-{{ message_type }}">
            {{ message }}
        </div>
        {% endif %}
    </div>
    <h1>{{ languages.admin_title }}</h1>
    <nav class="tabs">
      <button class="tab-btn active" data-tab="manage-users">{{ languages.admin_manage_users }}</button>
      <button class="tab-btn" data-tab="manage-items">{{ languages.admin_manage_items }}</button>
    </nav>

        <section id="manage-users" class="tab-content active">
            {% for user in users %}
            <div class="user-card">
                <div class="username">
                    {{ user.user_username }}
                </div>
                <div class="user-action">
                    {% if user.user_blocked_at == 0 %}
                    {% include "_button_block_user.html" %}
                    {% else %}
                    {% include "_button_unblock_user.html" %}
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </section>

        <section id="manage-items" class="tab-content active">
            {% for item in items %}
            <div class="item-card">
                <h3 class="item-name">
                    {{ item.item_name }}
                </h3>
                <div class="man-item-image">
                    {% for img_filename in images_by_item.get(item.item_pk, []) %}
                    <img src="{{ url_for('static', filename='uploads/' + img_filename) }}">
                    {% endfor %}
                </div>
                <div class="item-action">
                    {% if item.item_blocked_at == 0 %}
                    {% include "_button_block_item.html" %}
                    {% else %}
                    {% include "_button_unblock_item.html" %}
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </section>
            <script>
  document.addEventListener("DOMContentLoaded", () => {
    const tabs = document.querySelectorAll(".tab-btn");
    const contents = document.querySelectorAll(".tab-content");

    function activateTab(tabId) {
      tabs.forEach(t => t.classList.remove("active"));
      contents.forEach(c => c.classList.remove("active"));

      const tab = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
      const content = document.getElementById(tabId);
      if (tab && content) {
        tab.classList.add("active");
        content.classList.add("active");
      }
    }

    const savedTab = sessionStorage.getItem("activeTab");
    if (savedTab) {
      activateTab(savedTab);
    } else {
      activateTab(tabs[0].getAttribute("data-tab"));
    }

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const selected = tab.getAttribute("data-tab");
        activateTab(selected);
        sessionStorage.setItem("activeTab", selected);
      });
    });
  });
</script>

</main>

{% include "_footer.html" %}
